# Basic reverse proxy + rate limit + static /docs + /health
limit_req_zone $binary_remote_addr zone=scan:10m rate=30r/m;

server {
  listen 80;
  server_name _;

  # Health endpoint for uptime checks (200 OK)
  location /health { return 200; }

  # Rate limit all proxied requests (tune as needed)
  location / {
    proxy_pass         http://app:8501;
    proxy_http_version 1.1;
    proxy_set_header   Host $host;
    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header   X-Forwarded-Proto http;
    limit_req          zone=scan burst=10 nodelay;
  }

  # Serve static policy docs: /docs/*
  location /docs/ {
    alias /usr/share/nginx/html/docs/;
    autoindex off;
  }
}
